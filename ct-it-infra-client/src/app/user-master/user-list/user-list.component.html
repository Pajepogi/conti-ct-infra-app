<div class="location-container">
  <div class="list-heading">
  </div>

  <div class="table-container mat-elevation-z8">
    <div class="section">
      <div class="left-section">
        <div class="search">
          User
        </div>
      </div>
      <div class="right-section">
        <button class="new-location" data-bs-toggle="modal" data-bs-target="#staticBackdrop">+ Add</button>
      </div>
    </div>
    <hr>
    <mat-table #table [dataSource]="dataSource" matSort>

      <ng-container matColumnDef="empid">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Emp ID</mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.userId}} </mat-cell>
      </ng-container>


      <ng-container matColumnDef="mailAddress">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Mail Address</mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.email}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="roles">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Roles </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.roleName}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="locations">
        <mat-header-cell *matHeaderCellDef mat-sort-header> Locations </mat-header-cell>
        <mat-cell *matCellDef="let element"> {{element.locations}} </mat-cell>
      </ng-container>

      <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef> Action </th>
        <td mat-cell *matCellDef="let element" class="action-link">
          <img src="assets/images/edit.png" style="cursor: pointer;margin-right: 8px;" 
          data-bs-toggle="modal" data-bs-target="#staticBackdrop3"
          (click)="editUser(element)">
          <img src="assets/images/delete.png" style="margin-left: 5px;cursor: pointer;" 
           data-bs-toggle="modal" data-bs-target="#staticBackdrop2"
          (click)="deleteUser(element)">
        </td>
      </ng-container>

      <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
      <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
    </mat-table>
    
      <mat-paginator class="customPaginator" [length]="totalRows" [pageIndex]="currentPage" [pageSize]="pageSize"
          [pageSizeOptions]="pageSizeOptions" showFirstLastButtons (page)="pageChanged($event)" 
          >
      </mat-paginator>

  </div>

  
</div>
<div class="alert alert-success" role="alert" *ngIf="formSubmitAlert">
  <h5 class="text-center" style="margin-top: 1px">{{message}}</h5>
</div>
<div class="col d-flex align-items-center justify-content-center">
  <img src="../../../assets/images/loading1.png" alt="" class="loader" *ngIf="isLoading">

</div>


<div class="modal fade" id="staticBackdrop" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h1 class="SearchUserTxt" >Search User</h1>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"
          (click)="searchResultTabClosed()"></button>
      </div>
      <div class="modal-body">
        <form class="row g-3" [formGroup]="searchUserForm" id="user" (ngSubmit)="searchUser()">
          <div class="col-md-6">
            <label for="employeeId" class="form-label">Employee ID</label>
            <input type="text" class="form-control" name="employeeId" id="employeeId" autocomplete="off" formControlName="employeeId">
            <small *ngIf="!employeeId.valid && employeeId.touched" class="validationMessage"> Employee Id should be minimum 5 characters long.
            </small>
          </div>
          <div class="col-md-6">
            <label for="emailaddress" class="form-label">E-Mail Address</label>
            <input type="text" class="form-control" name="emailAddress" id="emailAddress" autocomplete="off" formControlName="emailAddress">
            <small *ngIf="!emailAddress.valid && emailAddress.touched" class="validationMessage"> Email address is not in correct format.
            </small>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button class="searchbtn" (click)="searchUser()" [disabled]="!(searchUserForm.valid && searchUserForm.dirty)">Search</button>
      </div>

      <div *ngIf="rearchResultTable" style="margin: 20px">
        <div><span class="searchResult"> Search Result </span><span style="float:right">
          <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi bi-sliders" viewBox="0 0 16 16">
            <path fill-rule="evenodd" d="M11.5 2a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM9.05 3a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0V3h9.05zM4.5 7a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zM2.05 8a2.5 2.5 0 0 1 4.9 0H16v1H6.95a2.5 2.5 0 0 1-4.9 0H0V8h2.05zm9.45 4a1.5 1.5 0 1 0 0 3 1.5 1.5 0 0 0 0-3zm-2.45 1a2.5 2.5 0 0 1 4.9 0H16v1h-2.05a2.5 2.5 0 0 1-4.9 0H0v-1h9.05z"/>
          </svg>
        </span></div>
        <hr style="color:grey; font-size: 10px; width: 100%;">
        <form>
          <table class="table">
            <thead>
              <tr>
                <th scope="col">Action</th>
                <th scope="col">Name</th>
                <th scope="col">E-Mail Address</th>
                <th scope="col">Roles</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let user of searchUserList">
                <th scope="row">
                  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-plus-circle" viewBox="0 0 16 16" data-bs-toggle="modal" data-bs-target="#staticBackdrop1" style="cursor:pointer" (click)="addUser(user)">
                    <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                    <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
                  </svg>
                </th>
                <td> {{ user.displayName }} </td>
                <td>{{ user.email }} </td>
                <td> {{ user.roleName }}  </td>
              </tr>
            </tbody>
          </table>
        </form>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="staticBackdrop1" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div><span class="searchResult"> Roles</span>
      </div>
      <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body"  style="min-height:140px">
          <div id="demo">
            <div class="wrapper" >
                <div class="content" >
                    <ul>
                      <li class="dropdown-item" *ngFor=" let role of roles">
                        <label for="role" class="radio-btn">
                          <input type="checkbox" value="{{role.roleName}}" id="cb1" (change)="roleCheckboxEvent($event)" #staticBackdrop1>
                          {{role.roleName}}
                        </label>
                      </li>
                    </ul>
                </div>
                <div class="parent">&nbsp;<i class="arrow down icons" *ngIf="!arrowAnimate"></i>
                   <i class="arrow up icons" id="upArrow" *ngIf="arrowAnimate"></i>
                  </div>
            </div>
</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn searchbtn" data-bs-dismiss="modal"  style=" margin: 0px auto;" (click)="saveUser()">SAVE</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="staticBackdrop3" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1"
  aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <div><span class="searchResult"> Update User</span>
        </div>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body"  style="min-height:140px">
        
          <div id="demo" >
            <div class="wrapper" >
                <div class="content">
                    <ul>
                      <li class="dropdown-item" *ngFor=" let role of roles;let i = index">
                        <label for="role" class="radio-btn">
                          <input type="checkbox" value="{{role.roleName}}" id="{{i}}" (change)="editRoleCheckbox($event)" #staticBackdrop3>
                          {{role.roleName}}
                        </label>
                      </li>
                    </ul>
                </div>
                <div class="parent" >&nbsp;
                  <span>
                    <i class="arrow down icons" id="downArrow" *ngIf="!arrowAnimate"></i>
                   <i class="arrow up icons" id="upArrow" *ngIf="arrowAnimate"></i>
                  </span>
                  </div>
            </div>
</div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn searchbtn" data-bs-dismiss="modal"  style=" margin: 0px auto;" (click)="updateUser()">SAVE</button>
      </div>
    </div>
  </div>
</div>



<div class="modal fade" id="staticBackdrop2" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
       <div class="modal-title fs-5 m-auto" id="staticBackdropLabel">
           <svg xmlns="http://www.w3.org/2000/svg" width="112" height="112" fill="#FEA500" class="bi bi-exclamation-circle mt-4 popupImage" viewBox="0 0 16 16">
              <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
              <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
            </svg>
        </div>
      <div class="modal-body m-auto">
        <p class="popupSubHeadingText">Are you sure?</p>
        <p class="popupBodyTextMsg">You want to delete the user</p>
      </div>
      <div class="m-auto pb-5">
        <button type="button" class="btn popupCancelButton" data-bs-dismiss="modal">Cancel</button>
        <button type="button" class="btn popupConfirmButton" data-bs-dismiss="modal" (click)="deletePopupConfirmButton()">Confirm</button>
      </div>
    </div>
  </div>
</div>




